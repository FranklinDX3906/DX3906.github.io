<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹´åº¦å¤§æŠ½å¥–</title>
    <style>
        /* ä¿®æ”¹é¡µé¢æ•´ä½“å¸ƒå±€ */
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
            margin-top: 50px;
            background-color: #f5f5f5;
        }

        /* ä¿®æ”¹å­—æ¯æ± å’Œæ•°å­—æ± çš„æ ·å¼ */
        .pool {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            justify-content: center;
            margin: 10px 0;  /* ä¸Šä¸‹é—´è· */
            width: 80%;      /* å®½åº¦å æ¯” */
            max-width: 800px; /* æœ€å¤§å®½åº¦ */
        }

        /* å•ä¸ªå­—æ¯æˆ–æ•°å­—çš„æ ·å¼ */
        .item {
            width: 40px;
            height: 40px;
            border: 1px solid #ccc;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s ease;
        }

        /* å­—æ¯æ± çš„èƒŒæ™¯è‰² */
        .letters .item {
            background-color: #e3f2fd;  /* æµ…è“è‰²èƒŒæ™¯ */
        }

        /* æ•°å­—æ± çš„èƒŒæ™¯è‰² */
        .numbers .item {
            background-color: #fff3e0;  /* æµ…æ©™è‰²èƒŒæ™¯ */
        }

        /* è¢«é€‰ä¸­é¡¹ç›®çš„æ ·å¼ */
        .selected {
            background-color: #4CAF50 !important;
            color: white;
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(76,175,80,0.3);
        }

        /* ç»“æœæ˜¾ç¤ºåŒºåŸŸè°ƒæ•´ */
        #result {
            text-align: center;
            margin: 20px;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            width: 80%;
            max-width: 600px;
        }

        /* å¥–é¡¹æ ‡ç­¾æ ·å¼ */
        .prize-label {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        /* æŠ½å¥–æŒ‰é’®æ ·å¼ */
        button {
            padding: 12px 30px;
            font-size: 18px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 25px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(76,175,80,0.3);
        }

        /* æŒ‰é’®æ‚¬åœæ•ˆæœ */
        button:hover {
            background-color: #45a049;
            transform: translateY(-2px);
        }

        /* ç¦ç”¨æŒ‰é’®çš„æ ·å¼ */
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
        }

        /* å†å²è®°å½•åŒºï¿½ï¿½æ ·å¼ */
        #historyResults {
            margin-top: 30px;
            text-align: center;
            width: 80%;
            max-width: 400px;
        }

        /* å†å²è®°å½•ä¸­æ¯ä¸ªé¡¹ç›®çš„æ ·å¼ */
        .history-item {
            margin: 15px 0;
            padding: 10px;
            font-size: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        /* ä¸€ç­‰å¥–æ ·å¼ */
        .first {
            color: #f1c40f;           /* é‡‘è‰² */
            border-left: 4px solid #f1c40f;
        }

        /* äºŒç­‰å¥–æ ·å¼ */
        .second {
            color: #7f8c8d;           /* é“¶è‰² */
            border-left: 4px solid #7f8c8d;
        }

        /* ä¸‰ç­‰å¥–æ ·å¼ */
        .third {
            color: #cd7f32;           /* é“œè‰² */
            border-left: 4px solid #cd7f32;
        }

        /* æŒ‰é’®ç»„æ ·å¼è°ƒæ•´ */
        .button-group {
            margin-top: 20px;
        }

        /* æ·»åŠ  Canvas æ ·å¼ */
        #fireworksCanvas {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            pointer-events: none !important;
            z-index: 9999 !important;
            background: transparent !important;
        }

        h1 {
            color: #d4341f; /* å–œåº†çš„çº¢è‰² */
            font-size: 36px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
            font-weight: bold;
            background: linear-gradient(45deg, #d4341f, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            padding: 10px 20px;
            border-radius: 8px;
            position: relative;
        }

        h1::after {
            content: 'ğŸ‰';
            position: absolute;
            right: -40px;
            top: 50%;
            transform: translateY(-50%);
        }

        h1::before {
            content: 'ğŸ‰';
            position: absolute;
            left: -40px;
            top: 50%;
            transform: translateY(-50%);
        }
    </style>
</head>
<body>
    <h1>å¹´åº¦å¤§æŠ½å¥–</h1>
    
    <!-- å­—æ¯æ± å®¹å™¨ -->
    <div class="pool letters" id="letterPool"></div>
    
    <!-- æ•°å­—æ± å®¹å™¨ -->
    <div class="pool numbers" id="numberPool"></div>

    <!-- ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
    <div id="result">
        <div class="prize-label" id="prizeLabel"></div>
        <span id="letterResult"></span>
        <span id="numberResult"></span>
    </div>

    <!-- æŒ‰é’®ç»„ -->
    <div class="button-group">
        <button onclick="draw()" id="drawButton">å¼€å§‹æŠ½å¥–</button>
        <button onclick="reset()" id="resetButton">é‡ç½®æŠ½å¥–</button>
    </div>

    <!-- å†å²è®°å½•åŒºåŸŸ -->
    <div id="historyResults"></div>

    <!-- Canvas -->
    <canvas id="fireworksCanvas"></canvas>

    <script>
        // å®šä¹‰å­—æ¯å’Œæ•°å­—æ± 
        const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        const numbers = '0123456789';
        // æ§åˆ¶æŠ½å¥–çŠ¶æ€çš„å˜é‡
        let isDrawing = false;        // æ˜¯å¦æ­£åœ¨æŠ½å¥–
        let drawCount = 0;            // å·²æŠ½å¥–æ¬¡æ•°
        const maxDraws = 3;           // æœ€å¤§æŠ½å¥–æ¬¡æ•°

        // åˆå§‹åŒ–å‡½æ•°ï¼šåˆ›å»ºå­—æ¯æ± å’Œæ•°å­—æ± 
        function initializePools() {
            const letterPool = document.getElementById('letterPool');
            const numberPool = document.getElementById('numberPool');
            
            // åˆ›å»ºæ‰€æœ‰å­—æ¯å…ƒç´ 
            letters.split('').forEach(letter => {
                letterPool.innerHTML += `<div class="item">${letter}</div>`;
            });
            
            // åˆ›å»ºæ‰€æœ‰æ•°å­—å…ƒç´ 
            numbers.split('').forEach(number => {
                numberPool.innerHTML += `<div class="item">${number}</div>`;
            });
        }

        // è·å–å¥–é¡¹åç§°
        function getPrizeName(count) {
            switch(count) {
                case 1: return "ä¸‰ç­‰å¥–";
                case 2: return "äºŒç­‰å¥–";
                case 3: return "ä¸€ç­‰å¥–";
                default: return "";
            }
        }

        // è·å–å¥–é¡¹å¯¹åº”çš„CSSç±»å
        function getPrizeClass(count) {
            switch(count) {
                case 1: return "third";
                case 2: return "second";
                case 3: return "first";
                default: return "";
            }
        }

        // ä¿®æ”¹çƒŸèŠ±ç‰¹æ•ˆçš„å®ç°
        function createFireworks(prizeLevel) {
            console.log('Creating fireworks for prize level:', prizeLevel);
            const canvas = document.getElementById('fireworksCanvas');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const ctx = canvas.getContext('2d');
            
            if (!ctx) {
                console.error('æ— æ³•è·å– Canvas ä¸Šä¸‹æ–‡');
                return;
            }

            // æ ¹æ®å¥–é¡¹è®¾ç½®é¢œè‰²å’Œæ•°é‡
            let color, burstCount;
            switch(prizeLevel) {
                case 3: // ä¸€ç­‰å¥–
                    color = '#FFD700'; // é‡‘è‰²
                    burstCount = 5;    // ä¸€ç­‰å¥–æ”¾5ä¸ªçƒŸèŠ±
                    break;
                case 2: // äºŒç­‰å¥–
                    color = '#C0C0C0'; // é“¶è‰²
                    burstCount = 3;    // äºŒç­‰å¥–æ”¾3ä¸ªçƒŸèŠ±
                    break;
                case 1: // ä¸‰ç­‰å¥–
                    color = '#CD7F32'; // é“œè‰²
                    burstCount = 2;    // ä¸‰ç­‰å¥–æ”¾2ä¸ªçƒŸèŠ±
                    break;
            }

            // åˆ›å»ºå•ä¸ªçƒŸèŠ±çˆ†ç‚¸æ•ˆæœ
            function createBurst(centerX, centerY) {
                let particles = [];
                const particleCount = 30;  // æ¯ä¸ªçƒŸèŠ±çš„ç²’å­æ•°
                
                // åˆ›å»ºç²’å­
                for (let i = 0; i < particleCount; i++) {
                    const angle = (Math.PI * 2 * i) / particleCount;
                    particles.push({
                        x: centerX,
                        y: centerY,
                        radius: 4,          // ç²’å­å¤§å°
                        angle: angle,
                        speed: 4,           // ç²’å­é€Ÿåº¦
                        opacity: 1,
                        life: 100          // ç²’å­ç”Ÿå‘½å‘¨æœŸ
                    });
                }

                function animate() {
                    // æ¸…é™¤ä¸Šä¸€å¸§ï¼Œä½¿ç”¨å®Œå…¨é€æ˜çš„èƒŒæ™¯
                    ctx.clearRect(0, 0, canvas.width, canvas.height);

                    let isAlive = false;

                    // æ›´æ–°å’Œç»˜åˆ¶æ‰€æœ‰ç²’å­
                    particles.forEach(particle => {
                        if (particle.life > 0) {
                            // æ›´æ–°ç²’å­ä½ç½®
                            particle.x += Math.cos(particle.angle) * particle.speed;
                            particle.y += Math.sin(particle.angle) * particle.speed;
                            particle.speed *= 0.99;  // é€æ¸å‡é€Ÿ
                            particle.life--;
                            particle.opacity = particle.life / 100;

                            // ç»˜åˆ¶ç²’å­
                            ctx.beginPath();
                            ctx.arc(particle.x, particle.y, particle.radius, 0, Math.PI * 2);
                            ctx.fillStyle = `${color}`;
                            ctx.globalAlpha = particle.opacity;
                            ctx.fill();

                            isAlive = true;
                        }
                    });

                    ctx.globalAlpha = 1;

                    if (isAlive) {
                        requestAnimationFrame(animate);
                    } else {
                        // å½“ç²’å­æ¶ˆå¤±æ—¶ï¼Œæ¸…é™¤ç”»å¸ƒ
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                    }
                }

                animate();
            }

            // åœ¨ä¸åŒä½ç½®åˆ›å»ºå¤šä¸ªçƒŸèŠ±
            for (let i = 0; i < burstCount; i++) {
                setTimeout(() => {
                    const x = Math.random() * (canvas.width * 0.6) + canvas.width * 0.2;
                    const y = Math.random() * (canvas.height * 0.6) + canvas.height * 0.2;
                    createBurst(x, y);
                }, i * 500);  // æ¯éš”500msåˆ›å»ºä¸€ä¸ªæ–°çš„çƒŸèŠ±
            }

            // åœ¨æ‰€æœ‰çƒŸèŠ±ç»“æŸåæ¸…é™¤ç”»å¸ƒ
            setTimeout(() => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }, (burstCount + 1) * 500 + 2000);
        }

        // æŠ½å¥–ä¸»å‡½æ•°
        function draw() {
            if (isDrawing || drawCount >= maxDraws) return;
            isDrawing = true;
            drawCount++;
            
            const button = document.getElementById('drawButton');
            button.disabled = true;
            
            // æ ¹æ®æŠ½å¥–æ¬¡æ•°æ˜¾ç¤ºå¯¹åº”å¥–é¡¹
            const prizeName = getPrizeName(drawCount);
            document.getElementById('prizeLabel').textContent = prizeName;
            
            // é‡ç½®æ‰€æœ‰é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.item').forEach(item => {
                item.classList.remove('selected');
            });

            // è®¾ç½®åŠ¨ç”»å‚æ•°
            let count = 0;
            const duration = 20;       // åŠ¨ç”»æŒç»­æ¬¡æ•°
            const interval = 100;      // åŠ¨ç”»é—´éš”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰

            // å¼€å§‹åŠ¨ç”»
            const animation = setInterval(() => {
                // éšæœºé€‰æ‹©å­—æ¯å’Œæ•°å­—
                const randomLetterIndex = Math.floor(Math.random() * letters.length);
                const randomNumberIndex = Math.floor(Math.random() * numbers.length);

                // æ›´æ–°å­—æ¯æ± çš„é€‰ä¸­çŠ¶æ€
                document.querySelectorAll('.letters .item').forEach((item, index) => {
                    item.classList.remove('selected');
                    if (index === randomLetterIndex) item.classList.add('selected');
                });

                // æ›´æ–°æ•°å­—æ± çš„é€‰ä¸­çŠ¶æ€
                document.querySelectorAll('.numbers .item').forEach((item, index) => {
                    item.classList.remove('selected');
                    if (index === randomNumberIndex) item.classList.add('selected');
                });

                count++;
                // åŠ¨ç”»ç»“æŸå¤„ç†
                if (count >= duration) {
                    clearInterval(animation);
                    isDrawing = false;
                    
                    const letter = letters[randomLetterIndex];
                    const number = numbers[randomNumberIndex];
                    const historyDiv = document.getElementById('historyResults');
                    const prizeClass = getPrizeClass(drawCount);
                    historyDiv.innerHTML = `<div class="history-item ${prizeClass}">${prizeName}: ${letter}${number}</div>` 
                        + historyDiv.innerHTML;

                    console.log('Animation ended, triggering fireworks for draw count:', drawCount);
                    createFireworks(drawCount);

                    if (drawCount >= maxDraws) {
                        button.disabled = true;
                        button.textContent = 'æŠ½å¥–ç»“æŸ';
                    } else {
                        button.disabled = false;
                    }
                }
            }, interval);
        }

        // æ·»åŠ é‡ç½®å‡½æ•°
        function reset() {
            // é‡ç½®æŠ½å¥–æ¬¡æ•°å’ŒçŠ¶æ€
            drawCount = 0;
            isDrawing = false;
            
            // é‡ç½®æŒ‰é’®çŠ¶æ€
            const drawButton = document.getElementById('drawButton');
            drawButton.disabled = false;
            drawButton.textContent = 'å¼€å§‹æŠ½å¥–';
            
            // æ¸…ç©ºå¥–é¡¹æ˜¾ç¤º
            document.getElementById('prizeLabel').textContent = '';
            
            // æ¸…ç©ºå†å²è®°å½•
            document.getElementById('historyResults').innerHTML = '';
            
            // ç§»ï¿½ï¿½ï¿½æ‰€æœ‰é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // æ¸…é™¤çƒŸèŠ±ç‰¹æ•ˆ
            const canvas = document.getElementById('fireworksCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // æ·»åŠ çª—å£å¤§å°æ”¹å˜æ—¶é‡ç½® Canvas å°ºå¯¸çš„å¤„ç†
        window.addEventListener('resize', () => {
            const canvas = document.getElementById('fireworksCanvas');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            // Canvas åˆå§‹åŒ–ä»£ç ä¿æŒä¸å˜
            const canvas = document.getElementById('fireworksCanvas');
            if (!canvas || !canvas.getContext) {
                console.error('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ Canvas');
                alert('æ‚¨çš„æµè§ˆå™¨å¯èƒ½ä¸æ”¯æŒ Canvasï¼Œè¯·å°è¯•ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Chromeã€Firefox æˆ– Edge æµè§ˆå™¨ã€‚');
                return;
            }

            const ctx = canvas.getContext('2d');
            if (!ctx) {
                console.error('æ— æ³•è·å– Canvas ä¸Šä¸‹æ–‡');
                alert('æ— æ³•åˆå§‹ï¿½ï¿½ Canvasï¼Œè¯·å°è¯•ä½¿ç”¨å…¶ä»–æµè§ˆå™¨ã€‚');
                return;
            }

            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            // åˆå§‹åŒ–æŠ½å¥–æ± 
            initializePools();
            
            // åˆå§‹æ˜¾ç¤ºä¸‰ç­‰å¥–
            document.getElementById('prizeLabel').textContent = 'ä¸‰ç­‰å¥–';
        };

        // ç¡®ä¿ Canvas æ ·å¼æ­£ç¡®è®¾ç½®
        document.head.insertAdjacentHTML('beforeend', `
            <style>
                #fireworksCanvas {
                    position: fixed !important;
                    top: 0 !important;
                    left: 0 !important;
                    width: 100% !important;
                    height: 100% !important;
                    pointer-events: none !important;
                    z-index: 9999 !important;
                    background: transparent !important;
                }
            </style>
        `);
    </script>
</body>
</html>
